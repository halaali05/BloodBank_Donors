@startuml
class BloodBankDashboardController {
---
-cloudFunctions: CloudFunctionsService
-auth: FirebaseAuth
getCurrentUserId(): String?
verifyRequestOwnership(): bool
deleteRequest(): Map<String, dynamic
fetchRequests(): BloodRequest[0..*]
calculateStatistics(): Map<String, int
}
BloodBankDashboardController ..> CloudFunctionsService
BloodBankDashboardController ..> FirebaseAuth
class ChatController {
---
-cloudFunctions: CloudFunctionsService
-authService: AuthService
-auth: FirebaseAuth
getCurrentUser(): User?
fetchMessages(): MapString, dynamic[0..*]
getUserRole(): String?
sendMessage(): void
formatTime(): String
formatTimeFromMillis(): String
isMessageFromCurrentUser(): bool
}
ChatController ..> CloudFunctionsService
ChatController ..> AuthService
ChatController ..> FirebaseAuth
class DonorDashboardController {
---
-auth: FirebaseAuth
-cloudFunctions: CloudFunctionsService
-authService: AuthService
getCurrentUser(): User?
getCurrentUserId(): String?
logout(): void
calculateStatistics(): Map<String, int
fetchRequests(): BloodRequest[0..*]
getUnreadNotificationsCount(): int
fetchUserProfile(): Map<String, dynamic?
extractDonorName(): String
}
DonorDashboardController ..> FirebaseAuth
DonorDashboardController ..> CloudFunctionsService
DonorDashboardController ..> AuthService
class DonorProfileController {
---
-cloudFunctions: CloudFunctionsService
fetchUserProfile(): Map<String, dynamic
updateProfileName(): Map<String, dynamic
}
DonorProfileController ..> CloudFunctionsService
class LoginController {
---
-authService: AuthService
validateInput(): bool
login(): LoginResult
resendVerification(): ResendVerificationResult
-_getAuthErrorTitle(): String
-_getAuthErrorMessage(): String
-_getResendVerificationErrorTitle(): String
-_getResendVerificationErrorMessage(): String
}
LoginController ..> AuthService
class NewRequestController {
---
-requestsService: RequestsService
validateLocation(): String?
validateAuthentication(): String?
validateRequest(): String?
createRequest(): Map<String, dynamic
}
NewRequestController ..> RequestsService
class NotificationsController {
---
-cloudFunctions: CloudFunctionsService
-notificationService: NotificationService
-auth: FirebaseAuth
getCurrentUser(): User?
fetchNotifications(): MapString, dynamic[0..*]
markAllAsRead(): void
markAsRead(): void
deleteNotification(): void
getUnreadNotifications(): MapString, dynamic[0..*]
formatTime(): String
}
NotificationsController ..> CloudFunctionsService
NotificationsController ..> NotificationService
NotificationsController ..> FirebaseAuth
class RegisterController {
---
-authService: AuthService
isValidEmail(): bool
validateForm(): String?
register(): RegisterResult
-_getAuthErrorTitle(): String
-_getAuthErrorMessage(): String
}
RegisterController ..> AuthService
class ResetPasswordController {
---
-passwordResetService: PasswordResetService
validateForm(): String?
resetPassword(): PasswordResetResult
-_getErrorMessage(): String
}
ResetPasswordController ..> PasswordResetService
class DefaultFirebaseOptions {
---
web: FirebaseOptions
android: FirebaseOptions
ios: FirebaseOptions
currentPlatform(): FirebaseOptions
}
DefaultFirebaseOptions ..> FirebaseOptions
class HayatApp {
---
-primaryColor: null
-bgColor: null
build(): Widget
-_buildTheme(): ThemeData
}
StatelessWidget <|-- HayatApp
class BloodRequest {
---
id: String
bloodBankId: String
bloodBankName: String
bloodType: String
units: int
isUrgent: bool
details: String
hospitalLocation: String
toMap(): Map<String, dynamic
}
class LoginResult {
---
success: bool
navigationRoute: Widget?
errorType: LoginErrorType?
errorMessage: String?
errorTitle: String?
}
LoginResult ..> Widget
LoginResult ..> LoginErrorType
class ResendVerificationResult {
---
success: bool
message: String?
errorTitle: String?
errorMessage: String?
}
class RegisterResult {
---
success: bool
emailVerified: bool
message: String?
errorTitle: String?
errorMessage: String?
}
class User {
---
uid: String
email: String
fullName: String?
bloodBankName: String?
location: String?
bloodType: String?
role: UserRole
createdAt: DateTime?
toMap(): Map<String, dynamic
}
User ..> UserRole
User ..> DateTime
class BloodBankDashboardScreen {
---
bloodBankName: String
location: String
createState(): State<BloodBankDashboardScreen
}
StatefulWidget <|-- BloodBankDashboardScreen
class _BloodBankDashboardScreenState {
---
-controller: BloodBankDashboardController
-refreshTimer: Timer?
-requests: List<BloodRequest>
-isLoading: bool
-error: String?
initState(): void
dispose(): void
-_loadRequests(): void
-_handleDeleteRequest(): void
-_handleLogout(): void
build(): Widget
}
State <|-- _BloodBankDashboardScreenState
_BloodBankDashboardScreenState ..> BloodBankDashboardController
_BloodBankDashboardScreenState ..> Timer
class _StatsGrid {
---
totalUnits: int
activeCount: int
urgentCount: int
normalCount: int
build(): Widget
}
StatelessWidget <|-- _StatsGrid
class ChatScreen {
---
requestId: String
initialMessage: String
recipientId: String?
createState(): State<ChatScreen
}
StatefulWidget <|-- ChatScreen
class _ChatScreenState {
---
-listPadding: null
-controller: ChatController
-textController: TextEditingController
-refreshTimer: Timer?
-messages: List<Map<String, dynamic>>
-isLoading: bool
-isSending: bool
-error: String?
-requestOwnerId: String?
-currentUserRole: String?
initState(): void
dispose(): void
-_initializeChat(): void
-_loadMessages(): void
-_loadUserRole(): void
-_sendMessage(): void
build(): Widget
}
State <|-- _ChatScreenState
_ChatScreenState ..> ChatController
_ChatScreenState ..> TextEditingController
_ChatScreenState ..> Timer
class ContactsScreen {
---
requestId: String
bloodType: String?
createState(): State<ContactsScreen
}
StatefulWidget <|-- ContactsScreen
class _ContactsScreenState {
---
-cloudFunctions: null
-donors: List<Map<String, dynamic>>?
-isLoading: bool
-error: String?
initState(): void
-_loadDonors(): void
build(): Widget
-_buildBody(): Widget
}
State <|-- _ContactsScreenState
class DonorDashboardScreen {
---
createState(): State<DonorDashboardScreen
}
StatefulWidget <|-- DonorDashboardScreen
class _DonorDashboardScreenState {
---
-controller: DonorDashboardController
-refreshTimer: Timer?
-notificationsTimer: Timer?
-requests: List<BloodRequest>
-userProfile: Map<String, dynamic>?
-unreadNotificationsCount: int
-isLoading: bool
-error: String?
initState(): void
dispose(): void
-_loadRequests(): void
-_loadUserProfile(): void
-_loadUnreadNotificationsCount(): void
-_handleLogout(): void
-_navigateToProfile(): void
-_navigateToNotifications(): void
-_navigateToChat(): void
build(): Widget
-_buildNotificationButton(): Widget
-_buildHeader(): Widget
}
State <|-- _DonorDashboardScreenState
_DonorDashboardScreenState ..> DonorDashboardController
_DonorDashboardScreenState ..> Timer
class DonorProfileScreen {
---
createState(): State<DonorProfileScreen
}
StatefulWidget <|-- DonorProfileScreen
class _DonorProfileScreenState {
---
-controller: DonorProfileController
-formKey: null
-name: null
-isEditing: bool
-saving: bool
-didInit: bool
-profileUpdated: bool
-refreshTimer: Timer?
-userData: Map<String, dynamic>?
-isLoading: bool
-error: String?
uid(): String
initState(): void
dispose(): void
-_loadUserProfile(): void
-_initOnce(): void
-_save(): void
build(): Widget
}
State <|-- _DonorProfileScreenState
_DonorProfileScreenState ..> DonorProfileController
_DonorProfileScreenState ..> Timer
class LoginScreen {
---
createState(): State<LoginScreen
}
StatefulWidget <|-- LoginScreen
class _LoginScreenState {
---
-emailController: TextEditingController
-passwordController: TextEditingController
-loginController: LoginController
-obscurePassword: bool
-isLoading: bool
dispose(): void
-_handleLogin(): void
-_handleResendVerification(): void
-_showValidationError(): void
-_showError(): void
-_navigateTo(): void
build(): Widget
}
State <|-- _LoginScreenState
_LoginScreenState ..> TextEditingController
_LoginScreenState ..> LoginController
class NewRequestScreen {
---
bloodBankName: String
initialHospitalLocation: String
createState(): State<NewRequestScreen
}
StatefulWidget <|-- NewRequestScreen
class _NewRequestScreenState {
---
-controller: NewRequestController
-bloodType: String
-units: int
-isUrgent: bool
-isLoading: bool
-detailsController: TextEditingController
-selectedHospitalLocation: String?
initState(): void
dispose(): void
-_submit(): void
-_decoration(): InputDecoration
build(): Widget
}
State <|-- _NewRequestScreenState
_NewRequestScreenState ..> NewRequestController
_NewRequestScreenState ..> TextEditingController
class NotificationsScreen {
---
initialTabIndex: int
createState(): State<NotificationsScreen
}
StatefulWidget <|-- NotificationsScreen
class _NotificationsScreenState {
---
-controller: NotificationsController
-refreshTimer: Timer?
-notifications: List<Map<String, dynamic>>
-isLoading: bool
-error: String?
-tabController: TabController
initState(): void
didUpdateWidget(): void
dispose(): void
-_loadNotifications(): void
-_handleMarkAllAsRead(): void
build(): Widget
}
State <|-- _NotificationsScreenState
_NotificationsScreenState ..> NotificationsController
_NotificationsScreenState ..> Timer
_NotificationsScreenState ..> TabController
class _NotificationsList {
---
notifications: List<Map<String, dynamic>>
controller: NotificationsController
onRefresh: VoidCallback
build(): Widget
}
StatelessWidget <|-- _NotificationsList
_NotificationsList ..> NotificationsController
_NotificationsList ..> VoidCallback
class ForgotPasswordScreen {
---
createState(): State<ForgotPasswordScreen
}
StatefulWidget <|-- ForgotPasswordScreen
class _ForgotPasswordScreenState {
---
-email: null
-passwordResetService: null
-loading: bool
-_sendResetEmail(): void
dispose(): void
build(): Widget
}
State <|-- _ForgotPasswordScreenState
class ResetPasswordScreen {
---
code: String
email: String?
createState(): State<ResetPasswordScreen
}
StatefulWidget <|-- ResetPasswordScreen
class _ResetPasswordScreenState {
---
-controller: ResetPasswordController
-pass1: null
-pass2: null
-loading: bool
-_handleResetPassword(): void
dispose(): void
build(): Widget
}
State <|-- _ResetPasswordScreenState
_ResetPasswordScreenState ..> ResetPasswordController
class RegisterScreen {
---
createState(): State<RegisterScreen
}
StatefulWidget <|-- RegisterScreen
class _RegisterScreenState {
---
-registerController: RegisterController
-authService: AuthService
-type: UserType
-nameController: TextEditingController
-hospitalNameController: TextEditingController
-emailController: TextEditingController
-passwordController: TextEditingController
-confirmPasswordController: TextEditingController
-selectedLocation: String?
-obscurePassword: bool
-obscureConfirmPassword: bool
-isLoading: bool
dispose(): void
-_handleSubmit(): void
build(): Widget
}
State <|-- _RegisterScreenState
_RegisterScreenState ..> RegisterController
_RegisterScreenState ..> AuthService
_RegisterScreenState ..> UserType
_RegisterScreenState ..> TextEditingController
class RequestDetailsScreen {
---
requestId: String
skipAutoMarkAsRead: bool
createState(): State<RequestDetailsScreen
}
StatefulWidget <|-- RequestDetailsScreen
class _RequestDetailsScreenState {
---
-requestsService: RequestsService
-request: BloodRequest?
-isLoading: bool
-error: String?
initState(): void
-_checkAuthentication(): void
-_loadRequest(): void
build(): Widget
}
State <|-- _RequestDetailsScreenState
_RequestDetailsScreenState ..> RequestsService
_RequestDetailsScreenState ..> BloodRequest
class WelcomeScreen {
---
build(): Widget
}
StatelessWidget <|-- WelcomeScreen
class SignupException {
---
message: String
shouldDeleteAuthAccount: bool
toString(): String
}
SignupException ..|> Exception
class AuthService {
---
-auth: FirebaseAuth
-cloudFunctions: CloudFunctionsService
signUpDonor(): Map<String, dynamic
signUpBloodBank(): Map<String, dynamic
login(): void
logout(): void
getUserRole(): String
currentUser(): User?
authStateChanges(): Stream<User?
getUserData(): models.User?
resendEmailVerification(): void
isEmailVerified(): bool
completeProfileAfterVerification(): Map<String, dynamic
}
AuthService ..> FirebaseAuth
AuthService ..> CloudFunctionsService
class CloudFunctionsService {
---
-functions: FirebaseFunctions
createPendingProfile(): Map<String, dynamic
completeProfileAfterVerification(): Map<String, dynamic
updateLastLoginAt(): Map<String, dynamic
updateFcmToken(): Map<String, dynamic
updateUserProfile(): Map<String, dynamic
getUserData(): Map<String, dynamic
getUserRole(): String
addRequest(): Map<String, dynamic
getRequests(): Map<String, dynamic
getRequestsByBloodBankId(): Map<String, dynamic
getNotifications(): Map<String, dynamic
getMessages(): Map<String, dynamic
markNotificationsAsRead(): Map<String, dynamic
markNotificationAsRead(): Map<String, dynamic
deleteNotification(): Map<String, dynamic
sendRequestMessageToDonors(): Map<String, dynamic
getDonors(): Map<String, dynamic
sendMessage(): Map<String, dynamic
deleteRequest(): Map<String, dynamic
-_handleNetworkError(): Exception
-_handleFunctionsException(): Exception
}
CloudFunctionsService ..> FirebaseFunctions
class FCMService {
---
instance: FCMService
initFCM(): void
-_handleNotificationClick(): void
}
FCMService ..> FCMService
class LocalNotifService {
---
instance: LocalNotifService
-plugin: FlutterLocalNotificationsPlugin
-channel: AndroidNotificationChannel
-inited: bool
init(): void
show(): void
-_handleNotificationClick(): void
}
LocalNotifService ..> LocalNotifService
LocalNotifService ..> FlutterLocalNotificationsPlugin
LocalNotifService ..> AndroidNotificationChannel
class NotificationService {
---
instance: NotificationService
-cloudFunctions: CloudFunctionsService
markAllAsRead(): void
markAsRead(): void
deleteNotification(): void
}
NotificationService ..> NotificationService
NotificationService ..> CloudFunctionsService
class PasswordResetService {
---
-auth: FirebaseAuth
sendPasswordResetEmail(): PasswordResetResult
confirmPasswordReset(): PasswordResetResult
-_getErrorMessage(): String
-_getConfirmResetErrorMessage(): String
}
PasswordResetService ..> FirebaseAuth
class PasswordResetResult {
---
success: bool
message: String
}
class RequestsService {
---
instance: RequestsService
-cloudFunctions: CloudFunctionsService
addRequest(): void
getRequests(): Map<String, dynamic
}
RequestsService ..> RequestsService
RequestsService ..> CloudFunctionsService
class AppTheme {
---
jordanianGovernorates: List<String>
deepRed: Color
offWhite: Color
cardBorder: Color
softBg: Color
fieldFill: Color
lineColor: Color
urgentRed: Color
urgentBg: Color
urgentCardBg: Color
borderRadius: double
borderRadiusSmall: double
borderRadiusLarge: double
padding: double
paddingSmall: double
paddingLarge: double
cardShadow: List<BoxShadow>
cardShadowLarge: List<BoxShadow>
appBarTheme: AppBarTheme
cardDecoration(): BoxDecoration
underlineInputDecoration(): InputDecoration
outlinedInputDecoration(): InputDecoration
primaryButtonStyle(): ButtonStyle
}
AppTheme ..> Color
AppTheme ..> AppBarTheme
class DialogHelper {
---
showWarning(): void
showSuccess(): void
showError(): void
showInfo(): void
}
class PasswordResetLinkHandler {
---
extractOobCode(): String?
isPasswordResetLink(): bool
handlePasswordResetLink(): bool
}
class LoginFormCard {
---
child: Widget
build(): Widget
}
StatelessWidget <|-- LoginFormCard
LoginFormCard ..> Widget
class LoginAvatar {
---
build(): Widget
}
StatelessWidget <|-- LoginAvatar
class PasswordField {
---
controller: TextEditingController
obscureText: bool
onToggleVisibility: VoidCallback
build(): Widget
}
StatelessWidget <|-- PasswordField
PasswordField ..> TextEditingController
PasswordField ..> VoidCallback
class PrimaryButton {
---
text: String
onPressed: VoidCallback?
isLoading: bool
build(): Widget
}
StatelessWidget <|-- PrimaryButton
PrimaryButton ..> VoidCallback
class LinkButton {
---
text: String
onPressed: VoidCallback?
build(): Widget
}
StatelessWidget <|-- LinkButton
LinkButton ..> VoidCallback
class RegisterLink {
---
onTap: VoidCallback
build(): Widget
}
StatelessWidget <|-- RegisterLink
RegisterLink ..> VoidCallback
class UserTypeToggle {
---
isDonor: bool
onChanged: ValueChanged<bool>
build(): Widget
}
StatelessWidget <|-- UserTypeToggle
UserTypeToggle ..> ValueChanged
class ConfirmPasswordField {
---
controller: TextEditingController
obscureText: bool
onToggleVisibility: VoidCallback
build(): Widget
}
StatelessWidget <|-- ConfirmPasswordField
ConfirmPasswordField ..> TextEditingController
ConfirmPasswordField ..> VoidCallback
class LocationDropdown {
---
selectedLocation: String?
onChanged: ValueChanged<String?>
build(): Widget
}
StatelessWidget <|-- LocationDropdown
LocationDropdown ..> ValueChanged
class ScreenTitle {
---
text: String
build(): Widget
}
StatelessWidget <|-- ScreenTitle
class LoginLink {
---
onTap: VoidCallback
build(): Widget
}
StatelessWidget <|-- LoginLink
LoginLink ..> VoidCallback
class ChatInputField {
---
controller: TextEditingController
isSending: bool
onSend: VoidCallback
sidePadding: double
borderRadius: double
bottomPadding: double
build(): Widget
}
StatelessWidget <|-- ChatInputField
ChatInputField ..> TextEditingController
ChatInputField ..> VoidCallback
class MessageBubble {
---
message: Map<String, dynamic>
isFromCurrentUser: bool
formattedTime: String
maxWidthPercentage: double
borderRadius: double
currentUserColor: Color
otherUserColor: Color
build(): Widget
}
StatelessWidget <|-- MessageBubble
MessageBubble ..> Color
class AppBarWithLogo {
---
title: String
actions: List<Widget>?
leading: Widget?
centerTitle: bool
build(): Widget
preferredSize(): Size
}
StatelessWidget <|-- AppBarWithLogo
AppBarWithLogo ..> Widget
AppBarWithLogo ..|> PreferredSizeWidget
class EmptyState {
---
icon: IconData
title: String
subtitle: String?
iconColor: Color?
build(): Widget
}
StatelessWidget <|-- EmptyState
EmptyState ..> IconData
EmptyState ..> Color
class ErrorBox {
---
title: String
message: String
onRetry: VoidCallback?
build(): Widget
}
StatelessWidget <|-- ErrorBox
ErrorBox ..> VoidCallback
class LoadingIndicator {
---
color: Color?
size: double?
build(): Widget
}
StatelessWidget <|-- LoadingIndicator
LoadingIndicator ..> Color
class SectionHeader {
---
title: String
subtitle: String
rightWidget: Widget?
build(): Widget
}
StatelessWidget <|-- SectionHeader
SectionHeader ..> Widget
class UrgentBadge {
---
showIcon: bool
build(): Widget
}
StatelessWidget <|-- UrgentBadge
class DonorHeader {
---
donorName: String
totalRequests: int
urgentCount: int
build(): Widget
}
StatelessWidget <|-- DonorHeader
class _PillStat {
---
label: String
value: String
highlight: bool
build(): Widget
}
StatelessWidget <|-- _PillStat
class DonorRequestCard {
---
request: BloodRequest
onMessage: VoidCallback?
build(): Widget
}
StatelessWidget <|-- DonorRequestCard
DonorRequestCard ..> BloodRequest
DonorRequestCard ..> VoidCallback
class HeaderCard {
---
title: String
subtitle: String?
icon: IconData
iconColor: Color?
build(): Widget
}
StatelessWidget <|-- HeaderCard
HeaderCard ..> IconData
HeaderCard ..> Color
class RequestCard {
---
request: BloodRequest
onDelete: VoidCallback?
onViewDonors: VoidCallback?
build(): Widget
}
StatelessWidget <|-- RequestCard
RequestCard ..> BloodRequest
RequestCard ..> VoidCallback
class StatCard {
---
title: String
value: String
icon: IconData
tint: Color
width: double?
build(): Widget
}
StatelessWidget <|-- StatCard
StatCard ..> IconData
StatCard ..> Color
class NotificationItemCloud {
---
notification: Map<String, dynamic>
formatTime: String Function(BuildContext, int?)
onMarkAsRead: Future<void> Function(String)?
onRefresh: VoidCallback?
build(): Widget
}
StatelessWidget <|-- NotificationItemCloud
NotificationItemCloud ..> VoidCallback
@enduml